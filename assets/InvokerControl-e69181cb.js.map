{"version":3,"file":"InvokerControl-e69181cb.js","sources":["../../.storybook/addons/storybook-invoke-addon/constants.ts","../../.storybook/addons/storybook-invoke-addon/InvokerControl.ts"],"sourcesContent":["export const ADDON_ID = 'addon-invoke';\r\nexport const PANEL_ID = `${ADDON_ID}/panel`;\r\nexport const PARAM_KEY = 'invoke';\r\n\r\nexport const PANEL_TAB_CONTENT_ID = 'panel-tab-content';\r\nexport const DOCBLOCK_ARGSTABLE_SELECTOR = '#panel-tab-content > div > div >.docblock-argstable';\r\n\r\nexport const CONTROL_TYPE = 'invoke';\r\n\r\nconst INVOKE = `${ADDON_ID}/invoke`;\r\n\r\nexport const EVENTS = { INVOKE };\r\n","import { addons, useStoryContext } from '@storybook/preview-api';\r\nimport { EVENTS } from './constants';\r\nimport type { Args, StoryId } from '@storybook/types';\r\n\r\nexport class InvokerControl<T extends Args, R = void> {\r\n  constructor(private key: string) {}\r\n\r\n  private storyId?: StoryId;\r\n\r\n  private callee?: (args: T) => R;\r\n\r\n  private readonly onInvoke = ({\r\n    storyId,\r\n    invoker,\r\n    args,\r\n  }: {\r\n    storyId: StoryId;\r\n    invoker: InvokerControl<T, R>;\r\n    args: T;\r\n  }) => {\r\n    // if (this.storyId !== storyId || invoker.key !== this.key) return;\r\n    if (invoker.key !== this.key) return;\r\n    this.invoke(args);\r\n  };\r\n\r\n  get isRegistered() {\r\n    return !!this.callee;\r\n  }\r\n\r\n  readonly useCallback = (callee: (args: T) => R) => {\r\n    // const { id } = useStoryContext();\r\n    // this.storyId = id;\r\n\r\n    const channel = addons.getChannel();\r\n    channel.off(EVENTS.INVOKE, this.onInvoke);\r\n    channel.on(EVENTS.INVOKE, this.onInvoke);\r\n\r\n    this.callee = callee;\r\n  };\r\n\r\n  readonly invoke = (args: T) => this.callee?.(args);\r\n}\r\n"],"names":["ADDON_ID","INVOKE","EVENTS","addons","InvokerControl","key","__publicField","storyId","invoker","args","callee","channel","_a"],"mappings":"wKAAO,MAAMA,EAAW,eASlBC,EAAS,GAAGD,WAELE,EAAS,CAAE,OAAAD,CAAO,ECX/B,CAAA,OAAAE,CAAA,EAAA,iCAIO,MAAMC,CAAyC,CACpD,YAAoBC,EAAa,CAEzBC,EAAA,gBAEAA,EAAA,eAESA,EAAA,gBAAW,CAAC,CAC3B,QAAAC,EACA,QAAAC,EACA,KAAAC,CAAA,IAKI,CAEAD,EAAQ,MAAQ,KAAK,KACzB,KAAK,OAAOC,CAAI,CAAA,GAOTH,EAAA,mBAAeI,GAA2B,CAI3C,MAAAC,EAAUR,EAAO,aACvBQ,EAAQ,IAAIT,EAAO,OAAQ,KAAK,QAAQ,EACxCS,EAAQ,GAAGT,EAAO,OAAQ,KAAK,QAAQ,EAEvC,KAAK,OAASQ,CAAA,GAGPJ,EAAA,cAAUG,GAAY,CDxC1B,IAAAG,ECwC0B,OAAAA,EAAA,KAAK,SAAL,YAAAA,EAAA,UAAcH,KAnCzB,KAAA,IAAAJ,CAAc,CAoBlC,IAAI,cAAe,CACV,MAAA,CAAC,CAAC,KAAK,MAChB,CAcF"}